<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dyslexia Reader | NeuroAid</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet" />
  <style>
    @font-face {
      font-family: 'OpenDyslexic';
      src: url('/static/fonts/OpenDyslexic-Regular.woff2') format('woff2'),
           url('/static/fonts/OpenDyslexic-Regular.woff') format('woff'),
           url('/static/fonts/OpenDyslexic-Regular.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    body, h1, h2, h3, h4, h5, h6, p, a, button, input, textarea, select, footer, nav {
      font-family: 'OpenDyslexic', Arial, sans-serif !important;
    }
  </style>

  <style>
    body { 
      min-height: 100vh; 
      display: flex; 
      flex-direction: column;
      background: #f9fafb;
    }
    main { flex: 1; }
    .ruler { position:absolute; height:2.2em; background:rgba(99,102,241,0.15); border-radius:6px; display:none }
    .reading-area { border:1px solid #e2e8f0; border-radius:12px; padding:20px; background:#fff; position:relative }
    .scrambled, .original { min-height:120px; border:1px dashed #cbd5e0; padding:14px; border-radius:10px }
    #reader.inter-font { font-family: 'Inter', sans-serif; }
    #reader.opendyslexic-font { font-family: 'OpenDyslexic', Arial, sans-serif; }
    
    /* Unique Card Design for Spacing */
    .card {
      background: #ffffff;
      border-radius: 1.5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      padding: 2.5rem;
    }
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 40px;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .navbar a {
      margin-left: 20px;
      text-decoration: none;
      color: #2d3748;
      font-weight: 600;
      transition: 0.2s;
    }
    .navbar a:hover { color: #4c51bf; }
  </style>
</head>
<body class="text-gray-800">

  <header class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-indigo-600">NeuroAid</h1>
      <nav class="flex items-center space-x-6">
        <a href="/" class="hover:text-indigo-500">Home</a>
        <a href="/dyslexia" class="hover:text-indigo-500">Dyslexia</a>
        <a href="/games" class="hover:text-indigo-500">Games</a>
        <a href="/dashboard" class="hover:text-indigo-500">Dashboard</a>
        <a href="/about" class="hover:text-indigo-500">About</a>
      </nav>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-6 py-16">
    <h2 class="text-3xl font-bold text-center text-indigo-700 mb-6">Understanding Dyslexia</h2>

    <div class="card bg-white mb-10 text-center">
      <p class="text-lg leading-relaxed text-gray-700">
        Dyslexia is a common learning difference that primarily affects a person‚Äôs ability to read, spell, 
        and process written language. It is not related to intelligence, but rather to the way the brain 
        processes information. People with dyslexia may struggle with reading fluency, word recognition, 
        and decoding, which can make learning in traditional classroom environments more challenging. 
        However, with the right support and tools, individuals with dyslexia can thrive academically and 
        professionally. Tools such as text-to-speech readers, adjustable fonts, and reading aids are 
        designed to reduce these challenges. The <span class="font-semibold text-indigo-600">Dyslexia-Friendly Reader</span> 
        below provides customizable text display, adjustable fonts, line spacing, and speech features to 
        help create a more accessible and supportive reading experience.
      </p>
    </div>

    <h2 class="text-2xl font-bold text-center text-indigo-700 mb-6">Dyslexia-Friendly Reader</h2>

    <section class="card space-y-8 mb-10">
      <div class="grid md:grid-cols-3 gap-6">
        <label class="flex flex-col text-sm font-medium">
          Font size
          <input id="fontSize" type="range" min="14" max="28" value="18" class="mt-2">
        </label>
        <label class="flex flex-col text-sm font-medium">
          Line height
          <input id="lineHeight" type="range" min="1.2" max="2.2" step="0.1" value="1.8" class="mt-2">
        </label>
        <label class="flex flex-col text-sm font-medium">
          Voice rate
          <input id="rate" type="range" min="0.6" max="1.6" step="0.1" value="1.0" class="mt-2">
        </label>
      </div>

      <div class="flex flex-wrap items-center gap-6">
        <label class="flex items-center gap-2">
          <input type="checkbox" id="rulerToggle" class="h-4 w-4"> Reading ruler
        </label>
        <div class="flex items-center gap-2">
          <label for="fontSelect" class="font-medium">Font Style:</label>
          <select id="fontSelect" class="border px-3 py-2 rounded">
            <option value="inter">Inter (Default)</option>
            <option value="opendyslexic">OpenDyslexic ‚Äì Dyslexia-Friendly</option>
          </select>
        </div>
        <button id="savePrefs" class="ml-auto px-6 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700">
          Save Preferences
        </button>
      </div>

      <div class="flex flex-wrap items-center gap-4">
        <select id="voiceSelect" class="border px-3 py-2 rounded flex-1 min-w-[200px]" aria-label="TTS voice"></select>
        <button id="speakBtn" class="px-5 py-2 bg-indigo-600 text-white rounded-lg shadow hover:bg-indigo-700">üîä Read Aloud</button>
        <button id="stopSpeakBtn" class="px-5 py-2 bg-red-500 text-white rounded-lg shadow hover:bg-red-600">‚èπ Stop</button>
      </div>
    </section>

    <section class="reading-area inter-font mt-10 card" id="reader" tabindex="0" aria-label="Reading area">
      <div class="ruler" id="ruler"></div>
      <textarea id="text-input" rows="6" placeholder="Paste or type text here‚Ä¶" class="w-full border rounded p-3"></textarea>
      
      <div class="grid md:grid-cols-2 gap-8 mt-8">
        <div class="original">
          <h4 class="font-semibold mb-2">Original</h4>
          <div id="original-text" class="min-h-[80px]"></div>
        </div>
        <div class="scrambled">
          <h4 class="font-semibold mb-2">Scrambled View</h4>
          <div id="scrambled-text" class="min-h-[80px]"></div>
        </div>
      </div>

      <div class="output mt-8 p-4 bg-gray-100 rounded-lg" id="read-aloud" aria-live="polite"></div>
    </section>

    <div class="mt-10 text-center">
      <a href="/" class="inline-block px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow hover:bg-indigo-700">
        ‚Üê Back to Home
      </a>
    </div>
  </main>

  <footer class="bg-gray-100 py-6 mt-12 text-center text-gray-600">
    <p>&copy; 2025 NeuroAid. All rights reserved.</p>
  </footer>

  <script>
    // === Elements ===
    const textInput = document.getElementById("text-input");
    const originalText = document.getElementById("original-text");
    const scrambledText = document.getElementById("scrambled-text");
    const reader = document.getElementById("reader");

    const fontSize = document.getElementById("fontSize");
    const lineHeight = document.getElementById("lineHeight");
    const fontSelect = document.getElementById("fontSelect");
    const rulerToggle = document.getElementById("rulerToggle");
    const savePrefs = document.getElementById("savePrefs");
    const ruler = document.getElementById("ruler");

    // === Reading Ruler ===
    reader.addEventListener("mousemove", (e) => {
      if (rulerToggle.checked) {
        ruler.style.display = "block";
        ruler.style.top = `${e.clientY - reader.getBoundingClientRect().top - 20}px`;
        ruler.style.left = 0;
        ruler.style.width = "100%";
      } else {
        ruler.style.display = "none";
      }
    });

    // === Apply Styles ===
    function applyStyles() {
      reader.style.fontSize = `${fontSize.value}px`;
      reader.style.lineHeight = lineHeight.value;
      reader.classList.remove("inter-font", "opendyslexic-font");
      reader.classList.add(
        fontSelect.value === "opendyslexic" ? "opendyslexic-font" : "inter-font"
      );
    }
    fontSize.addEventListener("input", applyStyles);
    lineHeight.addEventListener("input", applyStyles);
    fontSelect.addEventListener("change", applyStyles);

    // === Save Preferences ===
    savePrefs.addEventListener("click", () => {
      const prefs = {
        fontSize: fontSize.value,
        lineHeight: lineHeight.value,
        font: fontSelect.value,
        ruler: rulerToggle.checked,
      };
      localStorage.setItem("dyslexiaPrefs", JSON.stringify(prefs));
      alert("Preferences saved!");
    });

    // === Load Preferences ===
    window.addEventListener("load", () => {
      const prefs = JSON.parse(localStorage.getItem("dyslexiaPrefs"));
      if (prefs) {
        fontSize.value = prefs.fontSize;
        lineHeight.value = prefs.lineHeight;
        fontSelect.value = prefs.font;
        rulerToggle.checked = prefs.ruler;
        applyStyles();
      }
    });

    // === Scrambling (continuous animation) ===
    function scrambleWord(word) {
      if (word.length <= 3) return word;
      const middle = word.slice(1, -1).split("");
      for (let i = middle.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [middle[i], middle[j]] = [middle[j], middle[i]];
      }
      return word[0] + middle.join("") + word[word.length - 1];
    }

    let originalWords = [];
    let scrambleInterval;

    textInput.addEventListener("input", () => {
      const text = textInput.value;
      originalText.textContent = text;
      originalWords = text.split(/\s+/);
      if (scrambleInterval) clearInterval(scrambleInterval);
      scrambleInterval = setInterval(() => {
        scrambledText.textContent = originalWords.map(scrambleWord).join(" ");
      }, 800); // new scramble every 800ms
    });

    // === Text-to-Speech ===
    const speakBtn = document.getElementById("speakBtn");
    const stopSpeakBtn = document.getElementById("stopSpeakBtn");
    const rate = document.getElementById("rate");
    const voiceSelect = document.getElementById("voiceSelect");
    let synth = window.speechSynthesis;
    let utter;

    // Populate voices
    function populateVoices() {
      const voices = synth.getVoices();
      voiceSelect.innerHTML = "";
      voices.forEach((voice, i) => {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect.appendChild(option);
      });
    }
    populateVoices();
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = populateVoices;
    }

    speakBtn.addEventListener("click", () => {
      if (synth.speaking) synth.cancel();
      utter = new SpeechSynthesisUtterance(textInput.value);
      utter.rate = parseFloat(rate.value);

      const selectedVoice = synth.getVoices()[voiceSelect.value];
      if (selectedVoice) utter.voice = selectedVoice;

      synth.speak(utter);
    });

    stopSpeakBtn.addEventListener("click", () => synth.cancel());
  </script>
</body>
</html>